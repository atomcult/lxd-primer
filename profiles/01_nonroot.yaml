config:

  # Note that in this profile uid/gid 1000 is being mapped to 1000
  #     in the container. This is what we want since we'll primarily
  #     be acting as the non-root user created later in the cloud-init
  #     config.
  raw.idmap: both 1000 1000

  user.user-data: |
    #cloud-config
    package_upgrade: true
    packages:
      - fd-find
      - fish
      - git
      - kitty-terminfo
      - nnn
      - ripgrep
      - squashfuse
      - tree
    runcmd:
      # Make sure our new user owns their home directory
      - [chown, jbrock:jbrock, /home/jbrock]
      - [snap, install, starship]
      - [snap, install, --channel=latest/edge, snapcraft, --classic]
      # - [snap, set, system, experimental.parallel-instances=true]
      # - [snap, install, --name=snapcraft_6, --channel=6.x/stable, snapcraft, --classic]

    # Create a new user.
    # Here we create a new user, set their groups, sudo permissions, and default shell
    users:
      - name: jbrock
        gecos: Joseph Brock
        groups: users, admin
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/fish

description: Snapcraft 7 Build Container

# Everthing here is the same, but we mount to the new user's home directory
devices:
  dot-config:
    path: /home/jbrock/.config
    source: /home/jbrock/.local/share/lxd/nonroot/dot-config
    type: disk
  dot-vim:
    path: /home/jbrock/.vim
    source: /home/jbrock/.local/share/lxd/nonroot/dot-vim
    type: disk
  eth0:
    name: eth0
    network: lxdbr0
    type: nic
  root:
    path: /
    pool: default
    type: disk
  secrets:
    path: /home/jbrock/secrets
    source: /media/WORK/
    type: disk
  snaps:
    path: /home/jbrock/lab
    source: /home/jbrock/lab
    type: disk
  ssh-config:
    path: /home/jbrock/.ssh
    readonly: "true"
    source: /home/jbrock/.ssh/
    type: disk

name: nonroot
used_by: []
